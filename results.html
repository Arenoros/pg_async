<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>pg_async: Processing query results</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">pg_async
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Processing query results </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Result set (<a class="el" href="classtip_1_1db_1_1pg_1_1resultset.html">tip::db::pg::resultset</a>) is passed to client via supplied callback when a query receives results from the server. A <a class="el" href="classtip_1_1db_1_1pg_1_1resultset.html">tip::db::pg::resultset</a> is an object that provides an interface to reading and converting underlying data buffers. It is lightweight and is designed to be copied around by value. It can be stored in memory for later use.</p>
<p>A resultset object mimics standard container interface for the data rows. It provides random access to data rows via indexing operator and random access iterators.</p>
<p>A resultset row mimics standard container interface for the fields. It provides index operators for accessing fields by their index or by their name. It also provides random access iterators for iterating the fields.</p>
<p>Result set provides interface for reading field definitions.</p>
<h3>Checking the resultset</h3>
<div class="fragment"><div class="line">resultset res;</div>
<div class="line"><span class="keywordflow">if</span> (res.size() &gt; 0) {</div>
<div class="line">    <span class="comment">// Process the result set</span></div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">if</span> (!result.empty()) {</div>
<div class="line">    <span class="comment">// Process the result set</span></div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">if</span> (res) {</div>
<div class="line">    <span class="comment">// Process the result set</span></div>
<div class="line">}</div>
</div><!-- fragment --><h3>Accessing rows and fields</h3>
<div class="fragment"><div class="line">resultset res;</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> row : res) {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> field : row) {</div>
<div class="line">        <span class="comment">// Do something with the field value</span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">auto</span> first_row = res.front();</div>
<div class="line"><span class="keyword">auto</span> last_row = res.back();</div>
<div class="line"><span class="keyword">auto</span> mid_row = res[ res.size() / 2 ]; <span class="comment">// Index access</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">auto</span> first_field = first_row[0];      <span class="comment">// Access field by index</span></div>
<div class="line"><span class="keyword">auto</span> id_field = last_row[<span class="stringliteral">&quot;id&quot;</span>];       <span class="comment">// Access field by name</span></div>
</div><!-- fragment --><h3>Field descriptions</h3>
<div class="fragment"><div class="line">resultset res;</div>
<div class="line"><span class="comment">// Get a reference to field descriptions</span></div>
<div class="line"><a class="code" href="namespacetip_1_1db_1_1pg.html#ac08eadbd5b45e68e13cc1418b091aaf4">row_description_type</a> <span class="keyword">const</span>&amp; rd = res.row_description();</div>
</div><!-- fragment --><dl class="section see"><dt>See Also</dt><dd><a class="el" href="structtip_1_1db_1_1pg_1_1field__description.html" title="Description of a field returned by the backend. ">tip::db::pg::field_description</a> for reference</dd></dl>
<h3>Accessing field data</h3>
<p>Field values are extracted via the system of buffer parsers. Default format for PosgreSQL protocol is text, so most if a data type is extractable from a stream, it can be extracted from a text data buffer. If a special parsing routine is required, a text data parser must be provided. All datatypes can be extracted as strings.</p>
<p>For binary data format a data parser must be provided.</p>
<p>An exception tip::db::pg::value_is_null will be thrown if the field is null. A boost::optional can be used as a nullable datatype, the value will be cleared, and no exception will be thrown. A <code>coalesce</code> function can be used to get a default value if the field is null.</p>
<div class="fragment"><div class="line">field f = row[0];</div>
<div class="line"><a class="code" href="namespacetip_1_1db_1_1pg_1_1oids_1_1type__category.html#ac27caab84b1b9ca2db889191e8e3740ea26680b5383c9bd9c94f47cab2ee9b738">std::string</a> s = f.as&lt;<a class="code" href="namespacetip_1_1db_1_1pg_1_1oids_1_1type__category.html#ac27caab84b1b9ca2db889191e8e3740ea26680b5383c9bd9c94f47cab2ee9b738">std::string</a>&gt;();</div>
<div class="line">f.to(s); <span class="comment">// template parameter deduced from the paramter</span></div>
<div class="line"><span class="keywordtype">int</span> i = f.as&lt;<span class="keywordtype">int</span>&gt;();</div>
<div class="line">f.to(i);</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">if</span> (f.is_null()) {</div>
<div class="line">    boost::optional&lt;int&gt; <a class="code" href="namespacetip_1_1db_1_1pg.html#abf3f06f643efd18eee46553d166d068a">nullable</a> = f.as&lt; boost::optional&lt;int&gt; &gt;();</div>
<div class="line">    <span class="keywordtype">int</span> val = f.coalesce(100500);</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section see"><dt>See Also</dt><dd><a class="el" href="valueio.html">Values input/output</a></dd></dl>
<h4>Using tuples to extract row data</h4>
<p>A std::tuple can be used to extract data from row fields</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>data {</div>
<div class="line">    <span class="keywordtype">int</span> id;</div>
<div class="line">    <a class="code" href="namespacetip_1_1db_1_1pg_1_1oids_1_1type__category.html#ac27caab84b1b9ca2db889191e8e3740ea26680b5383c9bd9c94f47cab2ee9b738">std::string</a> <a class="code" href="namespacetip_1_1db_1_1pg_1_1oids_1_1type.html#aaf87c8940daa3074f460e823a1fc5ce5a4ff4f67014a79cf8ae759648418086ba">name</a>;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">query(alias, <span class="stringliteral">&quot;select id, name from some_table&quot;</span>)</div>
<div class="line">([](<a class="code" href="namespacetip_1_1db_1_1pg.html#a0e05740b9d676d3eb8c764785014a009">transaction_ptr</a> t, resultset res, <span class="keywordtype">bool</span> complete) {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> row : res) {</div>
<div class="line">        data d;</div>
<div class="line">        row.to(std::tie(d.id, d.name));</div>
<div class="line">    }</div>
<div class="line">},</div>
<div class="line">[](error::db_error <span class="keyword">const</span>&amp;) {</div>
<div class="line">});</div>
</div><!-- fragment --><dl class="section see"><dt>See Also</dt><dd><a class="el" href="valueio.html">Values input/output</a></dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000005">Todo:</a></b></dt><dd><p class="startdd">concept of an interface for a datatype that can be stored/retrieved from the database. Template functions enabled for such an interface. </p>
<p class="enddd">non-select command results</p>
</dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="querying.html">Running queries</a> </dd>
<dd>
<a class="el" href="classtip_1_1db_1_1pg_1_1resultset.html">tip::db::pg::resultset</a> </dd>
<dd>
<a class="el" href="classtip_1_1db_1_1pg_1_1query.html" title="Asynchronous query class. ">tip::db::pg::query</a> </dd>
<dd>
tip::db::pg::field_definition </dd></dl>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 3 2015 21:35:41 for pg_async by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
